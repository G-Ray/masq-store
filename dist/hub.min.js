!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).MasqHub=e()}}(function(){return function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return r(n||e)},d,d.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.set=function(e,t){var n=o(e);n[t.key]=t.value,n=r(e,n),window.localStorage.setItem(e,JSON.stringify(n))},n.get=function(e,t){var n=void 0,r=void 0,i=void 0;r=[],n=o(e);for(var a=0;a<t.keys.length;a++){try{i=n[t.keys[a]]}catch(e){i=null}r.push(i)}return r.length>1?r:r[0]},n.del=function(e,t){for(var n=o(e),i=0;i<t.keys.length;i++)delete n[t.keys[i]];n=r(e,n),window.localStorage.setItem(e,JSON.stringify(n))},n.clear=function(e){window.localStorage.removeItem(e)};var o=n.getAll=function(e){var t=window.localStorage.getItem(e);if(!t||0===t.length)return{};try{return JSON.parse(t)}catch(e){return{}}},r=(n.setAll=function(e,t){t=r(e,t),window.localStorage.setItem(e,JSON.stringify(t))},n.getMeta=function(e){var t=window.localStorage.getItem(e);if(!t||0===t.length)return{};try{return JSON.parse(t)._meta}catch(e){return{}}},n.setMeta=function(e,t,n){return(n=n||{}).updated||(n.updated=i()),t._meta=n,t}),i=function(){return"function"==typeof Date.now?Date.now():(new Date).getTime()}},{}],2:[function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.init=void 0;var r=o(e("./sync")),i=o(e("./api")),a=!1,s=[],c=void 0,l="",d=["get","set","del","clear","getAll","setAll","getMeta"],u=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a&&console.log(t)},f=(n.init=function(e){var t=!0;a=e.debug;try{window.localStorage||(t=!1)}catch(e){t=!1}if(!t)try{return window.parent.postMessage({"cross-storage":"unavailable"},"*")}catch(e){return}s=e.permissions||[],void 0!==navigator.onLine?(window.addEventListener("online",function(){y(!0,e)}),window.addEventListener("offline",function(){y(!1,e)}),y(navigator.onLine,e)):f(e),g()},function e(t){r.initWSClient(t.syncserver,t.syncroom).then(function(n){(c=n).onmessage=function(e){try{var t=JSON.parse(e.data),n=v(t.origin,t.request);n.client=l,n.sync=!0;var o="file://"===t.origin?"*":t.origin;window.parent.postMessage(n,o)}catch(e){u(e)}},c.onclose=function(n){u("WebSocket connection closed"),!1!==n.wasClean&&1006!==n.code||(u("..trying to reconnect"),window.timerID||(window.timerID=setInterval(function(){e(t)},3e3)))}}).catch(function(e){u(e)})}),g=function(){window.addEventListener?window.addEventListener("message",w,!1):window.attachEvent("onmessage",w),window.parent.postMessage({"cross-storage":"ready"},"*"),u("Listening to clients...")},w=function(e){var t=void 0,n=void 0,o=void 0,i=void 0;if(t="null"===e.origin?"file://":e.origin,"poll"===e.data["cross-storage"])return window.parent.postMessage({"cross-storage":"ready"},e.origin);if("ready"!==e.data["cross-storage"]){try{o=e.data}catch(e){return}o&&"string"==typeof o.method&&(i={client:o.client,result:{}},o.client&&(l=o.client),o.method&&(p(t,o.method)?(i=v(t,o),["set","setAll","del"].indexOf(o.method)>=0&&r.send(c,t,o)):i.error="Invalid "+o.method+" permissions for "+t,u("Sendind response data: "+i),n="file://"===t?"*":t,window.parent.postMessage(i,n)))}},v=function(e,t){var n=void 0,o=void 0;try{switch(t.method){case"get":o=i.get(e,t.params);break;case"set":o=i.set(e,t.params);break;case"del":o=i.del(e,t.params);break;case"clear":o=i.clear(e);break;case"getAll":o=i.getAll(e);break;case"setAll":o=i.setAll(e,t.params);break;case"getMeta":o=i.getMeta(e)}}catch(e){n=e.message}return{client:t.client||l,error:n,result:o}},p=function(e,t){var n=void 0,o=void 0;if(d.indexOf(t)<0)return!1;for(n=0;n<s.length;n++)if((o=s[n]).origin instanceof RegExp&&o.allow instanceof Array&&o.origin.test(e)&&o.allow.indexOf(t)>=0)return!0;return!1},y=function(e,t){e?f(t):(c&&c.close(),u("Working offline."))}},{"./api":1,"./sync":3}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initWSClient=function(e,t){return new Promise(function(n,o){e=e||"ws://localhost:8080",t=t||"foo";var r=void 0!==window.URL?new window.URL(t,e):e+t,i=new window.WebSocket(r);i.onopen=function(){return window.timerID&&(window.clearInterval(window.timerID),delete window.timerID),n(i)},i.onerror=function(e){return o("Could not connect to server at "+r)}})};n.send=function(e,t,n){e&&0!==t.length&&0!==Object.keys(n.params).length&&e.send(JSON.stringify({origin:t,request:n}))}},{}]},{},[2])(2)});
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).MasqHub=e()}}(function(){return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return o(n||e)},d,d.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.set=function(e,t){var n=r(e);n[t.key]=t.value,window.localStorage.setItem(e,JSON.stringify(n)),o(e)},n.get=function(e,t){var n=void 0,o=void 0,i=void 0;o=[],n=r(e);for(var a=0;a<t.keys.length;a++){try{i=n[t.keys[a]]}catch(e){i=null}o.push(i)}return o.length>1?o:o[0]},n.del=function(e,t){for(var n=r(e),i=0;i<t.keys.length;i++)delete n[t.keys[i]];window.localStorage.setItem(e,JSON.stringify(n)),o(e)},n.clear=function(e){window.localStorage.removeItem(e)};var r=n.getAll=function(e){var t=window.localStorage.getItem(e);if(!t||0===t.length)return{};try{return JSON.parse(t)}catch(e){return{}}},o=(n.setAll=function(e,t){window.localStorage.setItem(e,JSON.stringify(t)),o(e)},n.getMeta=function(e){var t=window.localStorage.getItem("meta_"+e);if(!t||0===t.length)return{};try{return JSON.parse(t)}catch(e){return{}}},n.setMeta=function(e,t){(t=t||{}).updated=i(),window.localStorage.setItem("meta_"+e,JSON.stringify(t))}),i=function(){return"function"==typeof Date.now?Date.now():(new Date).getTime()}},{}],2:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.init=void 0;var o=r(e("./sync")),i=r(e("./api")),a=!1,s=[],l=void 0,c="",d=["get","set","del","clear","getAll","setAll","getMeta"],u=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a&&console.log(t)},f=(n.init=function(e){var t=!0;a=e.debug;try{window.localStorage||(t=!1)}catch(e){t=!1}if(!t)try{return window.parent.postMessage({"cross-storage":"unavailable"},"*")}catch(e){return}s=e.permissions||[],o.initWSClient("foo").then(function(e){(l=e).onmessage=function(e){try{var t=JSON.parse(e.data),n=p(t.origin,t.request);u("Sendind updated data: "+n);var r="file://"===t.origin?"*":t.origin;window.parent.postMessage(n,r)}catch(e){u(e)}},f()}).catch(function(e){u(e),f()})},function(){window.addEventListener?window.addEventListener("message",g,!1):window.attachEvent("onmessage",g),window.parent.postMessage({"cross-storage":"ready"},"*"),u("Listening to clients...")}),g=function(e){var t=void 0,n=void 0,r=void 0,i=void 0;if(t="null"===e.origin?"file://":e.origin,"poll"===e.data["cross-storage"])return window.parent.postMessage({"cross-storage":"ready"},e.origin);if("ready"!==e.data["cross-storage"]){try{r=e.data}catch(e){return}r&&"string"==typeof r.method&&(i={client:r.client,result:{}},r.client&&(c=r.client),r.method&&(w(t,r.method)?(i=p(t,r),["set","setAll","del"].indexOf(r.method)>=0&&o.send(l,t,r)):i.error="Invalid "+r.method+" permissions for "+t,u("Sendind response data: "+i),n="file://"===t?"*":t,window.parent.postMessage(i,n)))}},p=function(e,t){var n=void 0,r=void 0;try{switch(t.method){case"get":r=i.get(e,t.params);break;case"set":r=i.set(e,t.params);break;case"del":r=i.del(e,t.params);break;case"clear":r=i.clear(e);break;case"getAll":r=i.getAll(e);break;case"setAll":r=i.setAll(e,t.params);break;case"getMeta":r=i.getMeta(e)}}catch(e){n=e.message}return{client:t.client||c,error:n,result:r}},w=function(e,t){var n=void 0,r=void 0;if(d.indexOf(t)<0)return!1;for(n=0;n<s.length;n++)if((r=s[n]).origin instanceof RegExp&&r.allow instanceof Array&&r.origin.test(e)&&r.allow.indexOf(t)>=0)return!0;return!1}},{"./api":1,"./sync":3}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initWSClient=function(e,t){return new Promise(function(n,r){t=t||"ws://localhost:8080/";var o=new window.WebSocket(t+e);o.onopen=function(){return console.log("Connected to "+t+e+"."),n(o)},o.onerror=function(e){var n="Could not connect to server at "+t;return console.log(n),r(n)}})};n.send=function(e,t,n){e&&0!==t.length&&0!==Object.keys(n.params).length&&e.send(JSON.stringify({origin:t,request:n}))}},{}]},{},[2])(2)});